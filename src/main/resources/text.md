### Подключение к менеджеру очередей

Менеджер очередей предоставляет механизм транспортных коннекторов для
подключения к себе различных приложений (производителей и потребителей),
а также механизм каналов (сетевых коннекторов) для подключения других
менеджеров очередей и создания между ними сети.

При создании коннекторов и каналов используется синтаксис URI. URI может
быть как простым для создания коннекторов, например:

tcp://localhost:61616?trace=true

так и составным при создании каналов, например:

static:(tcp://host1:61616,tcp://host2:61616)

<a id="transport_connectors"></a>

#### Транспортные коннекторы

Одним из первых типов URI, который вы, вероятно, будете использовать,
является URI транспорта для подключения к менеджеру очередей с помощью
какого-либо вида транспорта. Обычно TCP или VM являются первыми
транспортными средствами, которые вы будете использовать.

Следующая таблица показывает комбинации протоколов, которые клиенты
сообщений могут использовать для прямого подключения к менеджеру
очередей, также эти URI используются для настройки транспортного
коннектора в менеджере.

| **Проводной протокол** | **Транспортный протокол** | **URL**                                                                       |
|------------------------|---------------------------|-------------------------------------------------------------------------------|
| AUTO для коннектора    | TCP                       | auto://*Host*:*Port*                                                          |
| AUTO для коннектора    | TCP                       | auto+nio://*Host*:*Port*                                                      |
| AUTO для коннектора    | SSL                       | auto+ssl://*Host*:*Port*                                                      |
| AUTO для коннектора    | SSL                       | auto+ssl+nio://*Host*:*Port*                                                  |
| OpenWire               | TCP                       | tcp://*Host*:*Port*                                                           |
| OpenWire               | TCP                       | nio://*Host*:*Port*                                                           |
| OpenWire               | SSL                       | ssl://*Host*:*Port*                                                           |
| OpenWire               | HTTP                      | http://*Host*:*Port*                                                          |
| OpenWire               | HTTPS                     | https://*Host*:*Port*                                                         |
| AMQP or

 Stomp or

 MQTT                    | TCP                       | protocol://*Host*:*Port*                                                      |
| AMQP or

 Stomp or

 MQTT                    | TCP                       | protocol+nio://*Host*:*Port*                                                  |
| AMQP or

 Stomp or

 MQTT                    | SSL                       | protocol+ssl://*Host*:*Port*                                                  |
| AMQP or

 Stomp or

 MQTT                    | SSL                       | protocol+ssl+nio://*Host*:*Port*                                              |
| REST                   | HTTP                      | http://*Host*:*Port*/ demo/message/FOO/BAR ?timeout=10000 &type=queue

   Используйте тег &lt;jetty&gt; для настройки конечной точки REST в посреднике.  |
| RESTs                  | HTTPS                     | http://*Host*:*Port*/ demo/message/FOO/BAR ?timeout=10000 &type=queue         |
| VM                     | *N/A*                     | vm://*BrokerName*                                                             |

Перед обменом сообщениями по сети нам необходимо сериализовать их в
подходящую форму. Сообщения должны быть сериализованы в и из
последовательности байтов для отправки по каналам с использованием так
называемого проводного протокола. Проводной протокол по умолчанию,
используемый в Менеджере очередей, называется OpenWire. Протокол
OpenWire не специфичен для сетевого транспорта TCP и может
использоваться с другими сетевыми протоколами. Его основное назначение -
быть эффективным и обеспечивать быстрый обмен сообщениями по сети.

<a id="auto_transport"></a>

##### AUTO транспорт

  Менеджер очередей поддерживает обнаружение протокола проводного
формата. OpenWire, STOMP, AMQP и MQTT могут быть обнаружены
автоматически. Это позволяет совместно использовать один транспорт для
всех 4 типов клиентов.

***Включение AUTO поверх TCP***

Для настройки автоматического определения проводного формата через
TCP-соединение используйте выберете протокол auto при создании
коннектора.

***Включение AUTO поверх SSL***

Для настройки автоматического определения проводного формата через
соединение SSL используйте  auto+ssl транспорта. Например, добавьте
следующую конфигурацию транспорта в XML-файл:

&lt;transportConnector name="auto+ssl"
uri="auto+ssl://localhost:5671"/&gt;

***Включение AUTO over NIO***

Для настройки автоматического определения проводного формата через
TCP-соединение NIO используйте протокол auto+nio транспорта. 

***Включение AUTO over NIO SSL***

Для настройки автоматического обнаружения проводного формата через
соединение NIO SSL используйте протокол auto+nio+ssl транспорта.

***Настройка параметров AUTO транспорта***

Есть некоторые параметры конфигурации коннектора, которые можно
установить.

| **Параметр**                | **Значение по умолчанию** | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------------|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| protocolDetectionTimeOut    | 30000                     | Время до истечения времени ожидания соединения в миллисекундах. Это похоже на maxInactivityDuration. Если клиент подключается, но не отправляет данные или недостаточно данных для обнаружения протокола, поток будет сидеть и ждать, пока больше данных поступит через сокет. Это позволит менеджеру очередей уничтожить соединения, если они не завершат инициализацию протокола через определенный период времени.  |
| maxConnectionThreadPoolSize | MAX\_INT                  | Этот параметр позволяет настроить максимальный размер пула потоков, который обрабатывает попытки подключения. Снижение этого числа может помочь предотвратить исчерпание потоков менеджером очередей, если есть много разных клиентов, пытающихся подключиться одновременно. По умолчанию он выключен путем установки значения MAX\_INT                                                                                |

Пример настройки транспорта с максимальным временем обнаружения
протокола 5 секунд:

?protocolDetectionTimeOut=5000

***Настройка проводного формата***

OpenWire-это проводной формат по умолчанию, используемый Менеджером
очередей. Он обеспечивает высокоэффективный двоичный формат для
высокоскоростной передачи сообщений. Параметры OpenWire можно настроить
в строке параметров коннектора.

| **Префикс Параметра** | **Описание**                                       |
|-----------------------|----------------------------------------------------|
| wireFormat.           | Применяет параметр ко всем проводным форматам      |
| wireFormat.default.   | Применяет параметр к формату по умолчанию OpenWire |
| wireFormat.stomp.     | Применяет параметр к формату STOMP wire            |
| wireFormat.amqp.      | Применяет параметр к формату провода AMQP          |
| wireFormat.mqtt.      | Применяет параметр к формату провода MQTT          |

Пример свойства, применимого ко всем форматам:

?wireFormat.maxFrameSize=1000

Примером свойства, применяемого только к OpenWire, может быть:

?wireFormat.default.maxFrameSize=1000

***Настройка Включенных Проводных Протоколов***

По умолчанию доступны все проводные протоколы. Это можно настроить
только для включения определенных, установив свойство auto.protocols. 

| **Значение** | **Описание**          |
|--------------|-----------------------|
| default      | Включает OpenWire     |
| amqp         | Включает формат AMQP  |
| stomp        | Включает формат STOMP |
| mqtt         | Включает формат MQTT  |

Пример с включенными OpenWire и STOMP:

?auto.protocols=default,stomp

<a id="vm_transport"></a>

##### VM транспорт

Транспорт виртуальных машин позволяет клиентам подключаться друг к другу
внутри виртуальной машины без дополнительной сетевой коммуникации.
Используемое соединение не является соединением с сокетом, а вместо
этого использует прямые вызовы методов для включения
высокопроизводительной встроенной системы обмена сообщениями. Первый
клиент, который будет использовать подключение к виртуальной машине,
загрузит встроенный менеджер очередей. Последующие соединения прикрепят
того же менеджера очередей. Как только все подключения виртуальной
машины к менеджеру очередей будут закрыты, встроенный брокер
автоматически отключится.

Wire Format предоставляет механизм для маршалирования команд в и из
пакетов или в и из потоков, каналов и дейтаграмм (проводной формат,
формат протокола прикладного уровня).

***Транспортные опции***

| **Опция**        | **Значение по умолчанию** | **Описание**                                                                                                                                       |
|------------------|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| Маршалинг

 marshal           | false                     | Если значение равно true, каждая команда, отправляемая через транспорт, принудительно проходит через маршалинг и демаршалинг при помощи WireFormat |
| Проводной формат

 wireFormat        | default                   | Имя проводного протокола                                                                                                                           |
| wireFormat.\*    |                           | Все свойства с этим префиксом используются для настройки wireFormat. Подробнее см.                                                                 |
| Создать

 create            | true                      | Должен ли быть создан менеджер очередей по требованию, если он еще не существует                                                                   |
| Ожидание старта

 waitForStart      | -1                        | Если&gt; 0, указывает время ожидания в миллисекундах для ожидания запуска менеджера очередей. Значения -1 и 0 означают не ждать                    |
| broker.\*        |                           | Все свойства с этим префиксом используются для настройки менеджера очередей                                                                        |

<a id="amqp_transport"></a>

##### AMQP транспорт

***Включение AMQP через NIO***

Для лучшей масштабируемости (и производительности) протокол AMQP должен
быть настроен на использование NIO, а не по умолчанию TCP. Для
использования NIO используйте транспортную схему amqp + nio вместо amqp.

Этот транспорт использует транспорт NIO снизу и обычно использует
гораздо меньше потоков, чем стандартный соединитель. Этот соединитель
может помочь, если вы хотите использовать большое количество очередей

***Включение AMQP через SSL***

Для использования SSL используйте транспортную схему amqp + ssl вместо
amqp.

***Prefetch Size and Credit***

Когда получатель AMQP подключается к менеджеру, он сопоставляется с
потребителем JMS. У этого потребителя JMS должен быть установлен
соответствующий размер предварительной выборки. Брокер учитывает кредит,
установленный клиентом, или использует значение по умолчанию 1000, если
клиент не устанавливает его.

Пример: настройка размера prefetch size:

?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600&amp;transport.prefetch=10

В этом случае предпочтения клиента будут игнорироваться и будет
использоваться настроенное значение.

Вы также можете настроить ссылку получателя amqp на стороне брокера,
которая обрабатывает входящие сообщения. По умолчанию будет
использоваться кредит в размере 1000 сообщений, но вы можете
переопределить это, используя свойство providerCredit, например

?maximumConnections=1000&amp;wireFormat.maxFrameSize=104857600&amp;transport.producerCredit=10000

***Сопоставления с JMS***

Вот три основные стратегии преобразования, которые можно использовать с
AMQP для взаимодействовия с JMS API.

| **Strategy** | **Description**                                                                                                                    |
|--------------|------------------------------------------------------------------------------------------------------------------------------------|
| native       | (По умолчанию) Оборачивает байты сообщения AMQP в JMS BytesMessage и отображает заголовки сообщения AMQP в заголовки сообщения JMS |
| raw          | Обрабатывает байты сообщения AMQP в JMS BytesMessage                                                                               |
| jms          | Сопоставляет заголовки сообщения AMQP с заголовками сообщений JMS, а тело сообщения AMQP - с телом JMS                             |

Установите параметр transformer в транспортном коннекторе для желаемой
стратегии сопоставления. Например, чтобы взаимодействовать с JMS на
уровне полезной нагрузки, установите для параметра преобразователя
значение jms:

?transport.transformer=jms

***Как заголовки сообщений AMQP сопостовляются с заголовками JMS***

Следующие заголовки сопоставляются независимо от используемого
трансформатора:

| **AMQP Message** | **JMS Message**            | **Notes**                                                                                                  |
|------------------|----------------------------|------------------------------------------------------------------------------------------------------------|
|                  | JMS\_AMQP\_NATIVE          | Будет установлено значение true, если преобразователь является native или raw, в противном случае - false. |
| message-format   | JMS\_AMQP\_MESSAGE\_FORMAT |                                                                                                            |

Следующие сопоставления заголовков применяются, когда преобразователь
является native или jms:

| **AMQP Message**                         | **JMS Message**            | **Notes**                                                                  |
|------------------------------------------|----------------------------|----------------------------------------------------------------------------|
| application-properties.JMSXGroupID       | JMSXGroupID                |                                                                            |
| application-properties.JMSXGroupSequence | JMSXGroupSequence          |                                                                            |
| application-properties.JMSXUserID        | JMSXUserID                 |                                                                            |
| application-properties.\*\*name          | name                       |                                                                            |
| delivery-annotations.\*\*name            | JMS\_AMQP\_DA\_\*\*name    |                                                                            |
| footer.\*\*name                          | JMS\_AMQP\_FT\_\*\*name    |                                                                            |
| header.deliveryCount                     | JMSXDeliveryCount          |                                                                            |
| header.durable                           | JMSDeliveryMode            | javax.jms.Message.DEFAULT\_DELIVERY\_MODE если не установлено              |
| header.first-acquirer                    | JMS\_AMQP\_FirstAcquirer   |                                                                            |
| header.priority                          | JMSPriority                | javax.jms.Message.DEFAULT\_PRIORITY если не установлено                    |
| header.ttl                               | JMSExpiration              | javax.jms.Message.DEFAULT\_TIME\_TO\_LIVE если не установлено              |
| message-annotations.\*\*name             | JMS\_AMQP\_MA\_\*\*name    |                                                                            |
| message-annotations.x-opt-jms-type       | JMSType                    |                                                                            |
| message-annotations.x-opt-reply-type     | тип JMSReplyTo             | Разделенный запятой список queue, topic, или temporary. По умолчанию queue |
| message-annotations.x-opt-to-type        | тип JMSDestination         | Разделенный запятой список queue, topic, или temporary. По умолчанию queue |
| properties.content-encoding              | JMS\_AMQP\_ContentEncoding |                                                                            |
| properties.content-type                  | JMS\_AMQP\_ContentType     |                                                                            |
| properties.correlation-id                | JMSCorrelationID           |                                                                            |
| properties.creation-time                 | JMSTimestamp               |                                                                            |
| properties.group-sequence                | JMSXGroupSequence          |                                                                            |
| properties.message-id                    | JMSMessageID               | Автогенерация если не установлено                                          |
| properties.reply-to                      | JMSReplyTo                 | Имя JMSReplyTo                                                             |
| properties.reply-to-group-id             | JMS\_AMQP\_ReplyToGroupID  |                                                                            |
| properties.subject                       | JMS\_AMQP\_Subject         |                                                                            |
| properties.to                            | JMSDestination             | Имя JMSDestination                                                         |
| properties.user-id                       | JMSXUserID                 | properties.user-id a UTF-8 String.                                         |

Типы значений свойств AMQP преобразуются следующим образом:

| **AMQP Type** | **Java Type**    | **Notes**                                 |
|---------------|------------------|-------------------------------------------|
| binary        | String           | Hex encoding of the binary value          |
| bool          | Boolean          |                                           |
| byte          | Byte             |                                           |
| double        | Double           |                                           |
| float         | Float            |                                           |
| int           | Integer          |                                           |
| long          | Long             |                                           |
| short         | Short            |                                           |
| symbol        | String           |                                           |
| ubyte         | Byte or Short    | Short если: value &gt; Byte.MAX\_VALUE    |
| uint          | Integer or Long  | Long если: value &gt; Integer.MAX\_VALUE  |
| ulong         | Long             |                                           |
| ushort        | Short or Integer | Integer если: value &gt; Short.MAX\_VALUE |

***Как тело сообщения AMQP преображается в сообщение JMS***

Если для преобразователя задано значение jms, тогда тип сообщения JMS
будет зависеть от типа тела сообщения AMQP.

| **Body Type**      | **JMS Message Type** |
|--------------------|----------------------|
| AmqpSequence       | StreamMessage        |
| AmqpValue          | ObjectMessage        |
| AmqpValue с null   | Message              |
| AmqpValue с String | TextMessage          |
| AmqpValue с binary | BytesMessage         |
| AmqpValue с list   | StreamMessage        |
| Data               | BytesMessage         |
| null               | Message              |

<a id="mqtt_transport"></a>

##### MQTT транспорт

Менеджер очередей FESB поддерживает протокол MQTT и автоматически
сопоставляет клиенты JMS / NMS и MQTT. MQTT - это межмашинный (M2M)
транспорт сообщений для публикации / подписки.

***MQTT проводной формат***

MQTT использует компактный двоичный формат, который можно настроить с
помощью следующих параметров.

| **Опция**                           | **Значение по умолчанию** | **Описание**                                                                                                                                                                               |
|-------------------------------------|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Максимально допустимый размер кадра

 maxFrameSize                         | 268435456                 | Максимальный размер кадра, который можно отправить. Ограничение протокола составляет 256 мегабайт, и его значение не может быть установлено выше. Может помочь предотвратить атаки OOM DOS |

Для вступления в силу все параметры должны быть дополнены wireFormat.

***Включение MQTT через NIO***

Для лучшей масштабируемости (и производительности) вы можете
использовать протокол MQTT через транспорт NIO. Для этого просто
используйте транспортный префикс mqtt + nio вместо mqtt. Этот транспорт
использует транспорт NIO снизу и, как правило, использует гораздо меньше
потоков, чем стандартный разъем.

***Включение MQTT через NIO + SSL ***

Транспорт MQTT также поддерживает использование NIO и SSL. Чтобы
включить эту опцию, используйте протокол mqtt + nio + ssl

***Работа с пунктами назначения с MQTT ***

MQTT поддерживает иерархии и подстановочные знаки, хотя разделители и
символы различаются:

| **function** | **Менеджер очередей FESB** | **MQTT** |
|--------------|----------------------------|----------|
| разделитель  | .                          | /        |
| элемент      | \*                         | +        |
| поддерево    | &gt;                       | \#       |

Эти значения автоматически переносятся между клиентами, использующими
JMS / NMS / Stomp, и клиентами, использующими MQTTT. Например, клиент,
подписавшийся на «foo \#/bar», будет получать сообщения, опубликованные
в теме JMS на foo.blah.bar.

***Преобразования сообщений***

Сообщения MQTT преобразуются в JMS ByteMessage. И наоборот, тело любого
сообщения JMS преобразуется в байтовый буфер, чтобы быть полезной
нагрузкой сообщения MQTT.

***Keep Alive***

Когда клиент подключается, он отправляет продолжительность активности,
обычно по умолчанию равную 10 с. Менеджер очередей учитывает
продолжительность поддержки активности, устанавливая монитор
неактивности, который позволяет льготный период продолжительностью 1,5
\*. По истечении этого льготного периода соединение может быть закрыто,
если нет активности. Брокер, получающий PINGREQ и отправляющий PINGRESP,
считается активным для поддержания открытого соединения. Если клиент
отправляет значение keep-alive, равное 0, Менеджер очередей не будет
устанавливать монитор неактивности, и соединения не будут автоматически
отключаться из-за неактивности. Это, однако, может привести к
потенциально протекающим соединениям, поэтому на стороне сервера
(например, администратором) можно установить сохранение активности по
умолчанию, чтобы не допустить зависания неактивных соединений. Это
сохранение по умолчанию будет использоваться, только если указано, и
если клиент запрашивает значение keep-alive, равное 0. Единица для
значения keep-alive составляет миллисекунды. Чтобы включить значение по
умолчанию, MQTT на стороне сервера сохраняет активность:

?transport.defaultKeepAlive=60000

Предварительная выборка сообщения (Message Prefetch)

Когда клиент MQTT подключается, он локально создает JMS-подобного
потребителя для брокера. Размер предварительной выборки соответствует
значению по умолчанию для соответствующей подписки JMS. Подписки с QoS =
0 имеют предварительную выборку по умолчанию для обычных непостоянных
подписчиков разделов, а для QoS = 1 и QoS = 2 назначается размер
предварительной выборки для подписчиков постоянных разделов или подписок
в очереди в зависимости от используемой стратегии подписки.. Значения
предварительной выборки по умолчанию перечислены здесь. Чтобы изменить
значение по умолчанию для размера предварительной выборки, вы можете
использовать параметр транспорта activeMQSubscriptionPrefetch, например,

?transport.activeMQSubscriptionPrefetch=32766

***Стратегия подписки ***

Менеджер очередей является JMS-менеджером очередей в его основе, поэтому
должно быть некоторое отображение между подписками MQTT и семантикой
JMS. Подписки с QoS = 0 (не более одного раза) напрямую сопоставляются с
непостоянными разделами JMS. Для надежного обмена сообщениями, QoS = 1 и
QoS = 2, по умолчанию подписки преобразуются в постоянных подписчиков
разделов JMS. Такое поведение желательно в большинстве сценариев. В
некоторых случаях полезно сопоставить эти подписки с виртуальными
разделами. Виртуальные разделы обеспечивают лучшую масштабируемость и,
как правило, являются лучшим решением, если вы хотите использовать своих
подписчиков MQTT в сети менеджеров очередей. Чтобы изменить стратегию
подписки для использования виртуального раздела, используйте следующие
параметры:

?transport.subscriptionStrategy=mqtt-virtual-topic-subscriptions

***Удержанные сообщения***

Если сообщение было опубликовано с установленным флагом сохранения,
сообщение будет «запомнено» темой, поэтому при получении новой подписки
последнее сохраненное сообщение будет отправлено в подписку. Брокер
использует политику восстановления подписки на сохраненные сообщения для
хранения сообщений с установленным свойством ActiveMQ.Retain. Во время
преобразования сообщений сообщения MQTT с флагом сохранения становятся
сообщениями JMS с установленным свойством \_ActiveMQ.Retain \_ и
хранятся менеджером очередей.

<a id="tcp_transport"></a>

##### TCP транспорт

Позволяет клиентам подключаться к удаленному Менеджеру очередей с
помощью сокета TCP. Эти параметры конфигурации можно использовать для
настройки нижележащего транспорта TCP на стороне клиента с помощью
строки URI соединения клиента JMS или URI транспортного коннектора
менеджера очередей. Приведенные ниже параметры должны начинаться с
transport.\* при использовании в определении коннектора менеджера
очередей. Однако на стороне клиента префикс transport.\* должен быть
опущен.

Примеры

На стороне менеджера очередей (в TransportConnector):

?transport.threadName&transport.trace=false&transport.soTimeout=60000

На стороне клиента (в brokerURL):

tcp://localhost:61616?threadName&trace=false&soTimeout=60000

Параметры транспорта

| **Опция**               | **Значение по умолчанию** | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------------------|---------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| резервы

 backlog                  | 5000                      | Задает максимальное число соединений, ожидающих принятия сокетом транспортного сервера                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| closeAsync              | true                      | Если true, вызов закрытия сокета происходит асинхронно. Этот параметр должен быть установлен в false для протоколов, таких как STOMP, которые обычно используются в ситуациях, когда новое соединение создается для каждого чтения или записи. Это обеспечивает синхронный вызов закрытия сокета. Синхронное закрытие предотвращает исчерпание доступных сокетов из-за быстрого циклического соединения.                                                                                                                                                                                 |
| connectionTimeout       | 30000                     | Если&gt; = 1, значение устанавливает время ожидания соединения в миллисекундах. Значение 0 означает отсутствие тайм-аута. Отрицательные значения игнорируются                                                                                                                                                                                                                                                                                                                                                                                                                            |
| daemon                  | false                     | Если true, транспортный поток будет работать в режиме демона. Задайте для этого параметра значение true при встраивании менеджера очередей в контейнер Spring или веб-контейнер, чтобы контейнер мог корректно завершить работу                                                                                                                                                                                                                                                                                                                                                          |
| dynamicManagement       | false                     | Если true, то TransportLogger может управляться JMX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ioBufferSize            | 8 \* 1024                 | Определяет размер буфера, который будет использоваться между уровнем TCP и уровнем OpenWire, где происходит маршалинг на основе wireFormat                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| jmxPort                 | 1099                      | (Только клиент) Указывает порт, который будет использоваться сервером JMX для управления TransportLoggers. Это должно быть установлено только через URI либо клиентским производителем, либо потребителем, так как брокер создает свой собственный JMX-сервер. Указание альтернативного порта JMX полезно для разработчиков, которые тестируют брокера и клиента на одном компьютере и должны контролировать оба через JMX                                                                                                                                                               |
| keepAlive               | false                     | Если это правда, включает TCP KeepAlive для соединения с менеджером очередей, чтобы предотвратить тайм-аут соединений на уровне TCP. Это не следует путать с сообщениями KeepAliveInfo, используемыми InactivityMonitor                                                                                                                                                                                                                                                                                                                                                                  |
| logWriterName           | default                   | Устанавливает имя используемой реализации org.apache.activemq.transport.LogWriter. Имена сопоставляются с классами в каталоге resources/META-INF/services/org/apache/activemq/transport/logwriters                                                                                                                                                                                                                                                                                                                                                                                       |
| maximumConnections      | Integer.MAX\_VALUE        | Максимальное количество сокетов, разрешенное для этого брокера                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| minmumWireFormatVersion | 0                         | Минимальная версия удаленного wireFormat, которая будет принята. Примечание: если версия удаленного wireFormat ниже настроенной минимально допустимой версии, будет выдано исключение, и в попытке подключения будет отказано. Значение 0 означает отсутствие проверки версии удаленного wireFormat.                                                                                                                                                                                                                                                                                     |
| socketBufferSize        | 64 \* 1024                | Устанавливает размер в байтах для буфера чтения и записи принятого сокета                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| soLinger                | Integer.MIN\_VALUE        | Устанавливает опцию сокета soLinger, когда значение&gt; -1. При значении -1 опция сокета soLinger отключена                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| soTimeout               | 0                         | Устанавливает время ожидания сокета в миллисекундах. Значение 0 означает отсутствие тайм-аута                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| soWriteTimeout          | 0                         | Устанавливает время записи сокета в миллисекундах. Если операция записи в сокет не завершится до истечения указанного времени, сокет будет закрыт. Значение 0 означает отсутствие тайм-аута                                                                                                                                                                                                                                                                                                                                                                                              |
| stackSize               | 0                         | Установите размер стека потока фонового чтения транспорта. Должен быть указан кратно 128К. Значение 0 указывает, что этот параметр игнорируется                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| startLogging            | true                      | Если true, объект TransportLogger стека транспорта будет первоначально записывать сообщения в журнал. Этот параметр игнорируется, если только trace = true                                                                                                                                                                                                                                                                                                                                                                                                                               |
| tcpNoDelay              | false                     | Если true, опция сокета TCP\_NODELAY установлена. Это отключает Nagle’s алгоритм для передачи небольших пакетов                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| threadName              | N/A                       | Если указан этот параметр, имя потока изменяется во время вызова транспорта. Удаленный адрес добавляется так, что вызов, застрявший в транспортном методе, будет иметь информацию о назначении в имени потока. Это чрезвычайно полезно при использовании дампов потоков для выгрузки                                                                                                                                                                                                                                                                                                     |
| trace                   | false                     | Приводит к регистрации всех команд, отправляемых через транспорт. Для просмотра зарегистрированного вывода определите регистратор Log4j: log4j.logger.org.apache.activemq.transport.TransportLogger = DEBUG                                                                                                                                                                                                                                                                                                                                                                              |
| trafficClass            | 0                         | Класс трафика должен быть установлен на сокете                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| diffServ                | 0                         | (Только для клиента) Предпочтительный класс трафика дифференцированных услуг, устанавливаемый для исходящих пакетов, как описано в RFC 2475. Допустимые целочисленные значения: \[0,64\]. Допустимые значения строки: EF, AF \[1-3\] \[1-4\] или CS \[0-7\]. В JDK 6 работает только тогда, когда JVM использует стек IPv4. Чтобы использовать стек IPv4, установите системное свойство java.net.preferIPv4Stack = true. Примечание. Недопустимо указывать одновременно и diffServ, и typeOfService, поскольку они совместно используют одну и ту же позицию в заголовках пакетов TCP/IP |
| typeOfService           | 0                         | (Только для клиента) Предпочтительное значение типа услуги, которое будет установлено для исходящих пакетов. Допустимые целочисленные значения: \[0,256\]. С JDK 6 работает только тогда, когда JVM настроен на использование стека IPv4. Чтобы использовать стек IPv4, установите системное свойство java.net.preferIPv4Stack = true. Примечание. Недопустимо указывать и diffServ, и typeOfService одновременно, поскольку они совместно используют одну и ту же позицию в заголовках пакетов TCP/IP                                                                                   |
| useInactivityMonitor    | true                      | При значении false InactivityMonitor отключен, и время соединения никогда не истекает                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| useKeepAlive            | true                      | Когда true KeepAliveInfo сообщения отправляются на простое соединение, чтобы предотвратить его тайм-аут. Если для этого параметра задано значение false, то соединения по-прежнему останутся в тайм-ауте, если данные о соединении не были получены в течение указанного периода времени                                                                                                                                                                                                                                                                                                 |
| useLocalHost            | false                     | При истинном локальном соединении будет установлено значение localhost вместо фактического имени локального хоста. В некоторых операционных системах, таких как OS X, невозможно подключиться как локальное имя хоста, так что localhost лучше                                                                                                                                                                                                                                                                                                                                           |
| useQueueForAccept       | true                      | Когда истинно принятые сокеты помещаются в очередь для асинхронной обработки с использованием отдельного потока                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| wireFormat              | default                   | Название фабрики wireFormat для использования                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| wireFormat.\*           | N/A                       | Свойства с этим префиксом используются для настройки wireFormat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

<a id="nio_transport"></a>

##### NIO транспорт

NIO Транспорт очень похож на обычный транспорт TCP. Разница в том, что
он реализован с использованием NIO API, который может помочь с
производительностью и масштабируемостью. NIO - это вариант
транспортировки только на стороне сервера. Попытка использовать его на
стороне клиента создаст экземпляр обычного транспорта TCP. Транспортный
коннектор NIO подходит в следующих ситуациях:

-   Когда у вас есть большое количество клиентов, к которыми вы хотите
    подключиться к менеджеру очередей. Обычно число клиентов, которые
    могут подключиться к менеджеру очередей, ограничено числом потоков,
    поддерживаемых операционной системой. Поскольку реализация
    коннектора NIO запускает меньше потоков на клиента, чем коннектор
    TCP, вам следует рассмотреть возможность использования NIO в случае,
    если TCP не удовлетворяет вашим потребностям.

-   У вас большой сетевой трафик к менеджеру очередей - опять же,
    коннектор NIO обычно обеспечивает лучшую производительность, чем
    разъем TCP (с точки зрения использования меньшего количества
    ресурсов на стороне брокера), поэтому вы можете рассмотреть
    возможность его использования, когда обнаружите, что коннектор TCP
    не соответствует вашим потребностям.

Параметры конфигурации такие же, как для транспорта TCP.

Обратите внимание, что оригинальный транспорт NIO является заменой для
транспорта tcp, который использует протокол OpenWire. Другие сетевые
протоколы, такие как AMQP, MQTT, Stomp и т. Д., Также имеют свои
собственные транспортные реализации NIO. Обычно настраивается путем
добавления суффикса «+ nio» к префиксу протокола.

<a id="ssl_transport"></a>

##### SSL транспорт

Транспорт SSL позволяет клиентам подключаться к удаленному менеджеру
очередей, используя SSL через сокет TCP.

Параметры транспорта

Параметры конфигурации из TCP актуальны.

Параметры SSLServerSocket

Любая опция SSLServerSocket может быть установлена для
TransportConnection через? Transport.XXX, например:

?transport.enabledCipherSuites=SSL\_RSA\_WITH\_RC4\_128\_SHA,SSL\_DH\_anon\_WITH\_3DES\_EDE\_CBC\_SHA
ssl://localhost:61616?transport.needClientAuth=true

***Конфигурация клиента***

JMS-клиенты могут просто использовать ActiveMQSslConnectionFactory
вместе с URL-адресом брокера ssl://, как показано в следующей
конфигурации Spring. Если транспортный протокол SSL брокера не настроен
для transport.needClientAuth = true, клиенту не потребуется хранилище
ключей, но требуется хранилище доверенных сертификатов для подтверждения
сертификата брокера. Подобно конфигурации транспорта менеджера очередей,
вы можете передавать параметры транспорта SSL с помощью? Socket.XXX,
например,

ssl://localhost:61616?socket.enabledCipherSuites=SSL\_RSA\_WITH\_RC4\_128\_SHA,SSL\_DH\_anon\_WITH\_3DES\_EDE\_CBC\_SHA

[]{#_Toc9453628 .anchor}***NIO SSL транспорт***

Реализация SSL транспорта через NIO. Это позволяет подключать большое
количество клиентов SSL к одному экземпляру брокера. Только транспортная
опция на стороне сервера.

<a id="udp_transport"></a>

##### UDP транспорт

Транспорт UDP позволяет клиентам подключаться к удаленному менеджеру
очередей, используя сырой UDP.

Обратите внимание, что по умолчанию UDP не является надежным; датаграммы
могут быть потеряны, поэтому вы должны добавить уровень надежности,
чтобы гарантировать, что контракт JMS может быть реализован на
ненадежном транспорте.

| **Опция**                                             | **Значение по умолчанию** | **Описание**                                                                       |
|-------------------------------------------------------|---------------------------|------------------------------------------------------------------------------------|
| Минимальная версия Wireformat minmumWireFormatVersion | 0                         | Минимальная версия Wireformat, которая разрешена                                   |
| Регистрировать команды

 trace                                                  | false                     | Заставляет все команды, которые передаются по транспорту, быть зарегистрированным  |
| Использовать localhost

 useLocalHost                                           | true                      | При значении true имя локального компьютера будет преобразовано в «localhost»      |
| Создать

 datagramSize                                           | 4 \* 1024                 | Определяет размер дейтаграммы                                                      |
| Проводной формат

 wireFormat                                             | default                   | Имя проводного протокола                                                           |
| wireFormat.\*                                         |                           | Все свойства с этим префиксом используются для настройки wireFormat. Подробнее см. |

<a id="http_transport"></a>

##### HTTP and HTTPS транспорт

Транспорты HTTP и HTTPS используются для туннелирования по HTTP или
HTTPS с использованием полезных нагрузок XML. Это позволяет клиенту и
менеджеру очередей туннелировать через HTTP, избегая проблем с
брандмауэром.

Если клиент не JMS, вы можете вместо этого взглянуть на поддержку REST
или Ajax.

Менеджер очередей использует комбинацию объектов Jetty Server и
SslSocketConnector для связи через транспорт HTTPS.

<a id="websocket_transport"></a>

##### WebSockets транспорт

***Введение***

Помимо Ajax API, начиная с версии 5.4.0, вы можете использовать HTML5
WebSockets для обмена сообщениями с менеджером очередей из вашего
браузера. HTML 5 представил веб-сокеты как стандартизированный способ
асинхронной связи с сервером с веб-страницы. Это практически идеальный
канал для реализации асинхронного обмена сообщениями для веб-страниц.
Поскольку JavaScript легко обрабатывает текст и данные в формате JSON,
протокол Stomp является хорошим выбором для проводного протокола,
который будет использоваться через веб-сокеты. Также поддерживается
эффективный двоичный протокол MQTT через веб-сокеты. Это решение должно
улучшить возможности обмена сообщениями для клиентов JavaScript по
сравнению с простым Ajax API, поскольку реализация Stomp или MQTT в
JavaScript предоставляет гораздо более ориентированный на обмен
сообщениями API и такие функции, как, например, транзакции.

***Конфигурация ***

Менеджер очередей поставляется с транспортом WebSocket, который
реализует функциональность Stomp over WebSockets. Стоит отметить, что в
веб-сокетах (так же, как в Ajax) реализована та же политика
происхождения, поэтому вы можете получить доступ только к менеджерам
очередей, работающим на том же хосте, что и веб-приложение клиента.

***Secure Web Sockets ***

Версия 5.7.0 представила безопасную транспортную сеть. Для его настройки
вам понадобятся две вещи. Во-первых, вам нужно настроить новый
транспортный коннектор, чтобы мы использовали префикс wss url для
обозначения защищенной версии протокола. Далее вам необходимо
предоставить контекст SSL для этого транспорта. Вы можете сделать это,
предоставив sslContext в конфигурации вашего брокера аналогично тому,
как вы делали это для транспорта ssl или https. Вот и все, ваш
безопасный транспорт веб-сокета готов.

<a id="stomp_transport"></a>

##### Stomp транспорт

Менеджер очередей поддерживает протокол Stomp и сопоставление Stomp -
JMS. Это облегчает написание клиента на чистом Ruby, Perl, Python или
PHP для работы с Менеджером очередей.

***Stomp Wire Format***

Stomp использует текстовый проводной формат, который можно настроить с
помощью следующих параметров. Все параметры можно настроить на
URI-адресе транспортного брокера.

| **Опция**                           | **Значение по умолчанию** | **Описание**                                                                                                                                                              |
|-------------------------------------|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Максимальный размер тела сообщения

 maxDataLength                        | 104857600                 | Максимальный размер тела сообщения (содержимого), которое может быть отправлено                                                                                           |
| Максимально допустимый размер кадра

 maxFrameSize                         | MAX\_LONG                 | Максимальный размер кадра, который можно отправить. Кадр Stomp содержит команду, необязательные заголовки и необязательное тело. Может помочь предотвратить атаки OOM DOS |

Пример:

?wireFormat.maxFrameSize=1000000

***Включение Stomp через NIO***

Для лучшей масштабируемости и производительности протокол Stomp может
быть настроен для работы через транспорт NIO. Транспорт NIO будет
использовать гораздо меньше потоков, чем соответствующий соединитель
TCP. Это может помочь, когда требуется поддержка большого количества
очередей. Чтобы использовать NIO, измените схему URI транспортного
соединителя на stomp + nio.

***Включение Stomp через SSL***

Чтобы настроить Менеджер очередей для использования Stomp через
соединение SSL, измените схему URI на stomp + ssl.

***Период отсрочки сердцебиения***

Протокол STOMP (версия 1.1 или выше) определяет понятие сердцебиения как
метод, с помощью которого клиент и брокер могут определить
работоспособность основного TCP-соединения между ними. Менеджер очередей
поддерживает биение сердца STOMP, если клиент использует версию 1.1 (или
выше) протокола. Принудительное истечение времени ожидания для
считываний сердцебиения теперь настраивается с помощью новой опции
транспорта transport.hbGracePeriodMultiplier:

?transport.hbGracePeriodMultiplier=1.5

Этот множитель используется для расчета эффективного тайм-аута
сердечного ритма чтения, который брокер будет применять для каждого
соединения клиента. Множитель применяется к интервалу ожидания чтения,
который клиент указывает в своем кадре CONNECT.

***Работа с пунктами назначения с Stomp***

Обратите внимание, что префикс в stomp /queue/ или /topic/ удаляется из
строки перед передачей его Менеджеру очередей в качестве места
назначения JMS. Также обратите внимание, что разделителем по умолчанию в
системах MOM является. (Точка). В то время как FOO.BAR является
нормальным синтаксисом для определения места назначения типа очереди,
Stomp-эквивалентом является /queue/FOO.BAR

Сообщения STOMP не являются стойкими по умолчанию. Чтобы использовать
стойкие сообщения, добавьте следующий заголовок STOMP ко всем запросам
SEND: persistent: true

***Работа с текстовыми / байтовыми сообщениями JMS и Stomp***

Stomp - это очень простой протокол - в этом его прелесть! Как таковой,
он не знает сообщений JMS, таких как TextMessage или BytesMessage.
Протокол, однако, поддерживает заголовок content-length. Чтобы
обеспечить более надежное взаимодействие между клиентами STOMP и JMS,
Менеджер очередей отключает включение этого заголовка, чтобы определить,
какой тип сообщения создавать при отправке из Stomp в JMS. Логика
проста:

| **Включение заголовка content-length** | **Результирующее сообщение** |
|----------------------------------------|------------------------------|
| Да                                     | BytesMessage                 |
| Нет                                    | TextMessage                  |

Этой же логике можно следовать и при переходе от JMS к Stomp. Клиент
Stomp может быть записан, чтобы отключить включение заголовка
content-length, чтобы определить, какой тип структуры сообщения
предоставить пользователю.

STOMP поддерживает следующие стандартные свойства JMS для сообщений
SENT:

| **STOMP заголовок** | **JMS заголовок** | **Описание**                                                                     |
|---------------------|-------------------|----------------------------------------------------------------------------------|
| correlation-id      | JMSCorrelationID  | Хорошие потребители добавят этот заголовок к любым запросам ими ответам.         |
| expires             | JMSExpiration     | Время истечения сообщения                                                        |
| JMSXGroupID         | JMSXGroupID       | Определяет группы сообщений                                                      |
| JMSXGroupSeq        | JMSXGroupSeq      | Необязательный заголовок, который указывает порядковый номер в группах сообщений |
| persistent          | JMSDeliveryMode   | Стойкость                                                                        |
| priority            | JMSPriority       | Приоритет                                                                        |
| reply-to            | JMSReplyTo        | Направление, куда вы должны отправлять ответы                                    |
| type                | JMSType           | Тип сообщения                                                                    |

Вы можете добавить пользовательские заголовки в команды STOMP для
настройки протокола. Вот некоторые примеры:

| **Команда** | **Заголовок**                       | **Тип** | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------|-------------------------------------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| CONNECT     | client-id                           | string  | Указывает JMS clientID, который используется в сочетании с activemq.subcriptionName для обозначения постоянного абонента                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| SUBSCRIBE   | activemq.dispatchAsync              | boolean | Должны ли сообщения отправляться синхронно или асинхронно из потока производителя для недолговечных разделов в посреднике? Для быстрых потребителей установите значение false. Для медленных потребителей установите значение true, чтобы диспетчеризация не блокировала быстрых потребителей.                                                                                                                                                                                                                                                                                                                                       |
| SUBSCRIBE   | activemq.exclusive                  | boolean | Я хотел бы быть эксклюзивным потребителем в очереди                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| SUBSCRIBE   | activemq.maximumPendingMessageLimit | int     | Для медленной работы с потребителем по недолговечным разделам путем отбрасывания старых сообщений - мы можем установить максимально ожидаемый лимит, такой, что как только медленный потребитель возвращается к этой высокой отметке, мы начинаем отбрасывать старые сообщения.                                                                                                                                                                                                                                                                                                                                                      |
| SUBSCRIBE   | activemq.noLocal                    | boolean | Указывает, следует ли игнорировать локально отправленные сообщения для подписок. Установите значение true, чтобы отфильтровать локально отправленные сообщения                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| SUBSCRIBE   | activemq.prefetchSize               | int     | Задает максимальное количество ожидающих сообщений, которые будут отправлены клиенту. Как только этот максимум достигнут, больше сообщений не отправляется, пока клиент не подтвердит сообщение. Установите низкое значение&gt; 1 для справедливого распределения сообщений между потребителями, когда обработка сообщений может быть медленной. Примечание: если ваш клиент STOMP реализован с использованием динамического языка сценариев, например, Ruby, то этот параметр должен быть установлен равным 1, поскольку нет понятия размера сообщения на стороне клиента, подлежащего измерению. STOMP не поддерживает значение 0. |
| SUBSCRIBE   | activemq.priority                   | byte    | Устанавливает приоритет потребителя так, чтобы диспетчеризация могла быть взвешена в порядке приоритета                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| SUBSCRIBE   | activemq.retroactive                | boolean | Для недолговечных тем сделайте этот раздел обратным                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| SUBSCRIBE   | activemq.subscriptionName           | string  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| SUBSCRIBE   | selector                            | string  | Задает селектор JMS с использованием синтаксиса SQL 92, как указано в спецификации JMS 1.1. Это позволяет применять фильтр к каждому сообщению как часть подписки.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

<a id="uri_common_dest"></a>

#### URI общего назначения

***Параметры подключения***

Следующие опции должны иметь префикс jms. при использовании на brokerURL
или транспортном коннекторе

| **Опция**                           | **Значение по умолчанию** | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------------------------------|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| alwaysSessionAsync                  | true                      | При значении true отдельный поток используется для отправки сообщений для каждого сеанса в соединении. Отдельный поток всегда используется, когда существует более одного сеанса или сеанс не находится в режиме Session.AUTO\_ACKNOWLEDGE или Session.DUPS\_OK\_ACKNOWLEDGE                                                                                                                                                                                                                                             |
| alwaysSyncSend                      | false                     | Если установлено значение true, MessageProducer всегда будет использовать синхронизацию при отправке сообщения, даже если это не требуется для режима доставки                                                                                                                                                                                                                                                                                                                                                           |
| auditDepth                          | 2048                      | Размер окна сообщения, которое будет проверяться на наличие дубликатов и сообщений, вышедших из строя                                                                                                                                                                                                                                                                                                                                                                                                                    |
| auditMaximumProducerNumber          | 64                        | Максимальное количество производителей, которые будут проверены                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| checkForDuplicates                  | true                      | При значении true потребитель будет проверять наличие дублирующихся сообщений и правильно обрабатывать сообщение, чтобы убедиться, что оно не было обработано дважды непреднамеренно                                                                                                                                                                                                                                                                                                                                     |
| clientID                            | null                      | Устанавливает JMS clientID для использования для соединения                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| closeTimeout                        | 15000                     | Устанавливает время ожидания в миллисекундах, прежде чем закрытие считается завершенным. Обычно close() для соединения ожидает подтверждения от брокера. Это позволяет закрыть операцию до тайм-аута, предотвращая зависание клиента, когда нет доступного брокера                                                                                                                                                                                                                                                       |
| consumerExpiryCheckEnabled          | true                      | Определяет, выполняется ли проверка срока действия сообщения в каждом MessageConsumer до отправки сообщения. Отключение этой проверки может привести к потреблению просроченных сообщений                                                                                                                                                                                                                                                                                                                                |
| copyMessageOnSend                   | true                      | Должно ли сообщение JMS быть скопировано в новый объект сообщения JMS как часть метода send () в JMS. По умолчанию это включено, чтобы соответствовать спецификации JMS. Если для повышения производительности установлено значение false, если вы не изменяете сообщения JMS после их отправки                                                                                                                                                                                                                          |
| disableTimeStampsByDefault          | false                     | Устанавливает, следует ли отключать отметки времени в сообщениях или нет. Для небольшого повышения производительности установлено значение false                                                                                                                                                                                                                                                                                                                                                                         |
| dispatchAsync                       | false                     | Должен ли брокер отправлять сообщения асинхронно потребителю?                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| nestedMapAndListEnabled             | true                      | Определяет, поддерживаются ли свойства структурированного сообщения и MapMessages, чтобы свойства сообщения и записи MapMessage могли содержать вложенные объекты Map и List                                                                                                                                                                                                                                                                                                                                             |
| objectMessageSerializationDefered   | false                     | Когда объект установлен в ObjectMessage, спецификация JMS требует, чтобы объект был сериализован этим методом набора. Когда истина, объект не будет сериализован. Впоследствии объект может быть сериализован, если сообщение необходимо отправить через сокет или сохранить на диске.                                                                                                                                                                                                                                   |
| optimizeAcknowledge                 | false                     | Включает оптимизированный режим подтверждения, когда сообщения подтверждаются партиями, а не по отдельности. В качестве альтернативы вы можете использовать режим подтверждения Session.DUPS\_OK\_ACKNOWLEDGE для потребителей, который часто может быть быстрее. ВНИМАНИЕ: включение этой опции может вызвать некоторые проблемы с автоматическим подтверждением при переподключении.                                                                                                                                   |
| optimizeAcknowledgeTimeOut          | 300                       | Если&gt; 0, задает максимальное время в миллисекундах между пакетными подтверждениями, когда optimizeAcknowledge включен                                                                                                                                                                                                                                                                                                                                                                                                 |
| optimizedAckScheduledAckInterval    | 0                         | Если&gt; 0, указывает интервал времени, по истечении которого все ожидающие ACK доставляются при использовании оптимизированного подтверждения, так что долго работающий потребитель, который не получает больше сообщений, в конечном итоге будет подтверждать последние несколько сообщений без подтверждения                                                                                                                                                                                                          |
| optimizedMessageDispatch            | true                      | Если это правда, используется больший предел предварительной выборки - применимо только для постоянных подписчиков раздела                                                                                                                                                                                                                                                                                                                                                                                               |
| useAsyncSend                        | false                     | Принудительно использует Async Sends, что значительно увеличивает производительность; но означает, что метод send() немедленно вернет, было ли сообщение отправлено или нет, что может привести к потере сообщения                                                                                                                                                                                                                                                                                                       |
| useCompression                      | false                     | Позволяет использовать сжатие в теле сообщения                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| useRetroactiveConsumer              | false                     | Устанавливает, включены ли задним числом потребители. Обратные пользователи позволяют подписчикам на темы недолговременного периода получать старые сообщения, которые были опубликованы до запуска недолговечного подписчика                                                                                                                                                                                                                                                                                            |
| warnAboutUnstartedConnectionTimeout | 500                       | Тайм-аут в миллисекундах с момента создания соединения до момента, когда генерируется предупреждение, если соединение не запускается должным образом через Connection.start() и получатель получает сообщение. Это очень распространенная ошибка - забыть установить соединение и затем задаться вопросом, почему сообщения не доставляются, поэтому этот параметр по умолчанию используется для создания предупреждения, если пользователь забывает. Чтобы отключить предупреждение, просто установите значение &lt; 0. |

***Вложенные параметры***

Вы также можете настроить вложенные объекты на объекте соединения,
используя заданные префиксы. См. Javadoc для разбивки каждого отдельного
свойства.

| **Параметр**              | **Конфигурируемый объект**                                                                                                | **См. также**                                                                                  |
|---------------------------|---------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
| jms.blobTransferPolicy.\* | [*BlobTransferPolicy*](http://activemq.apache.org/maven/apidocs/org/apache/activemq/blob/BlobTransferPolicy.html)         | [*Blob Message*](http://activemq.apache.org/connection-configuration-uri)                      |
| jms.prefetchPolicy.\*     | [*ActiveMQPrefetchPolicy*](http://http/activemq.apache.org/maven/apidocs/org/apache/activemq/ActiveMQPrefetchPolicy.html) | [*What is the Prefetch Limit For?*](http://activemq.apache.org/what-is-the-prefetch-limit-for) |
| jms.redeliveryPolicy.\*   | [*RedeliveryPolicy*](http://activemq.apache.org/maven/apidocs/org/apache/activemq/RedeliveryPolicy.html)                  | [*Redelivery Policy*](http://activemq.apache.org/redelivery-policy)                            |

?jms.prefetchPolicy.all=100&jms.redeliveryPolicy.maximumRedeliveries=5

<a id="openwire"></a>

##### OpenWire проводной формат

OpenWire - это проводной формат по умолчанию, используемый менеджером
очередей. Он обеспечивает высокоэффективный двоичный формат для
высокоскоростной передачи сообщений. Параметры OpenWire можно настроить
в URI клиентского соединения JMS или в URI транспорта менеджера
очередей. Параметры проводного формата должны иметь префикс wireFormat.

| **Опция**                                              | **Значение по умолчанию** | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|--------------------------------------------------------|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Позволить кэширование

 cacheEnabled                                            | true                      | Должны ли часто повторяющиеся значения кэшироваться, чтобы происходило меньше маршалинга                                                                                                                                                                                                                                                                                                                                                                                        |
| Размер кэша

 cacheSize                                               | 1024                      | Когда cacheEnabled = true, этот параметр используется для указания количества значений, подлежащих кэшированию                                                                                                                                                                                                                                                                                                                                                                  |
| Максимальная продолжительность бездействия

 maxInactivityDuration                                   | 30000                     | Максимальная продолжительность бездействия (до которой сокет считается мертвым) в миллисекундах. На некоторых платформах сокет может долго существовать до уничтожения. Поэтому разрешите менеджеру очередей уничтожать соединения, если они неактивны в течение заданного периода времени. Используется некоторыми транспортными средствами для включения функции поддержки сердечного ритма (heart beat). Мониторинг неактивности отключен, если установлено значение &lt;= 0 |
| Начальная задержка перед началом проверки неактивности

 maxInactivityDurationInitalDelay                        | 10000                     | Начальная задержка перед началом проверки неактивности                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Максимально допустимый размер кадра

 maxFrameSize                                            | MAX\_LONG                 | Максимально допустимый размер кадра. Может помочь предотвратить атаки OOM DOS                                                                                                                                                                                                                                                                                                                                                                                                   |
| Отключить префикс размера пакета

 sizePrefixDisabled                                      | false                     | Должен ли быть префикс размера пакета перед маршалингом каждого пакета?                                                                                                                                                                                                                                                                                                                                                                                                         |
| Отправлять трассировку стека

 stackTraceEnabled                                       | true                      | Следует ли отправлять клиенту трассировку стека исключений, возникающих в брокере?                                                                                                                                                                                                                                                                                                                                                                                              |
| TCP\_NODELAY должен быть включен

 tcpNoDelayEnabled                                       | true                      | Не влияет на формат проводного соединения, но дает подсказку одноранговому узлу, что TCP\_NODELAY должен быть включен на сокете связи                                                                                                                                                                                                                                                                                                                                           |
| Включить оптимизацию кодировки

 tightEncodingEnabled                                    | true                      | Следует ли оптимизировать размер провода (канала) по сравнению с использованием процессора?                                                                                                                                                                                                                                                                                                                                                                                     |

Параметры проводного формата должны иметь префикс wireFormat. чтобы
вступить в силу, например, wireFormat.maxInactivityDuration = 10000.
Параметры, пропускающие этот префикс, будут игнорироваться.

<a id="hight_level_protocol"></a>

#### Протоколы высокого уровня

<a id="failover"></a>

##### Failover транспорт

Обычно используется для обеспечения логики переподключения клиентов к
сети менеджеров очередей или отдельного брокера.

Транспортные уровни Failover отвечают за логику повторного подключения
поверх любого другого транспорта. Синтаксис конфигурации позволяет вам
указать любое количество составных URI. Транспорт Failover случайным
образом выбирает один из составных URI и пытается установить соединение
с ним. Если это не удается, или впоследствии происходит сбой,
устанавливается новое соединение, выбирая один из других URI случайным
образом из списка.

Синтаксис конфигурации

failover:(uri1,...,uriN)?transportOptions&nestedURIOptions

или

failover:uri1,...,uriN

***Параметры транспорта***

| **Опция**                   | **Значение по умолчанию** | **Описание**                                                                                                                                                                                                                                                                                                                                                  |
|-----------------------------|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| backup                      | false                     | Инициализируйт и удерживайт второе транспортное соединение - чтобы включить быстрое переключение при сбое                                                                                                                                                                                                                                                     |
| initialReconnectDelay       | 10                        | Задержка (в мс) перед первой попыткой повторного подключения                                                                                                                                                                                                                                                                                                  |
| maxCacheSize                | 131072                    | Размер в байтах для кэша отслеживаемых сообщений. Применимо, только если trackMessages имеет значение true                                                                                                                                                                                                                                                    |
| maxReconnectAttempts        | -1 | 0                    | По умолчанию -1, постоянное повторение. 0 означает отключение повторного подключения                                                                                                                                                                                                                                                                          |
| maxReconnectDelay           | 30000                     | Максимальная задержка (в мс) между *второй и последующей *попытками повторного подключения.                                                                                                                                                                                                                                                                   |
| nested.\*                   | null                      | Общие параметры URI, которые будут применяться к каждому URI в списке **.**                                                                                                                                                                                                                                                                                   |
| randomize                   | true                      | Если true, выберается URI наугад из списка, чтобы использовать для повторного подключения                                                                                                                                                                                                                                                                     |
| reconnectDelayExponent      | 2.0                       | Показатель, используемый при попытках экспоненциального возврата.                                                                                                                                                                                                                                                                                             |
| reconnectSupported          | true                      | Определяет, должен ли клиент отвечать на ConnectionControl события брокера повторным подключением (см.: rebalanceClusterClients)                                                                                                                                                                                                                              |
| startupMaxReconnectAttempts | -1                        | Значение -1 указывает, что число попыток подключения при запуске должно быть неограниченным. Значение &gt;=0 равняется числу попыток повторного подключения при запуске, после которых клиенту будет отправлена ошибка при последующей попытке повторного подключения. **Примечание**: после успешного подключения maxReconnectAttempts параметр преобладает. |
| timeout                     | -1                        | Установите тайм-аут на операции отправки (в МС) без прерывания процесса повторного подключения.                                                                                                                                                                                                                                                               |
| trackMessages               | false                     | Храните кэш сообщений в полете, которые будут отправлены менеджеру очередей при повторном подключении                                                                                                                                                                                                                                                         |
| updateURIsSupported         | true                      | Определяет, должен ли клиент принимать обновления от брокера к его списку известных URI                                                                                                                                                                                                                                                                       |
| updateURIsURL               | null                      | URL-адрес (или путь к локальному файлу) к текстовому файлу, содержащему разделенный запятыми список URI для повторного подключения в случае сбоя                                                                                                                                                                                                              |
| useExponentialBackOff       | true                      | Если true между попытками повторного подключения используется экспоненциальное отступление.                                                                                                                                                                                                                                                                   |
| warnAfterReconnectAttempts  | 10                        | Значение &gt;0 указывает количество попыток повторного подключения до регистрации предупреждения. Зарегистрированное предупреждение указывает, что нет текущего соединения, но повторное соединение предпринимается. Значение &lt;=0 отключает ведение журнала предупреждений о попытках повторного подключения.                                              |

*\
**Использование Randomize***

Failover транспорт выбирает URI случайным образом по умолчанию. Это
эффективно балансирует нагрузку клиентов по нескольким менеджерам
очередей. Тем не менее, чтобы клиент подключался к первичному менеджеру
очередей резервного копирования в первую очередь и подключался к
вторичному менеджеру очередей резервного копирования только в том
случае, если первичный брокер недоступен, установите randomize=false.

Образец:

failover:(tcp://primary:61616,tcp://secondary:61616)?randomize=false

***Примечания***

При Failover транспорте операции отправки будут по умолчанию
блокироваться на неопределенное время, когда брокер становится
недоступным. Для обработки этого сценария доступны два
варианта. Во-первых, либо
установите [*TransportListener *](https://z5h64q92x9.net/proxy_u/en-ru.ru/activemq.apache.org/maven/apidocs/org/apache/activemq/transport/TransportListener.html)непосредственно
на [*ActiveMQConnectionFactory*](https://z5h64q92x9.net/proxy_u/en-ru.ru/activemq.apache.org/maven/apidocs/org/apache/activemq/ActiveMQConnectionFactory.html),
чтобы он был на месте перед любым запросом, который может потребовать
перехода по сети, или во-вторых, установите timeout
параметр. Этот timeout параметр приводит к сбою текущей операции
отправки после указанного времени ожидания.

Образец:

failover:(tcp://primary:61616)?timeout=3000

В этом примере, если соединение не установлено, операция отправки будет
выполнена через 3 секунды. Важно отметить, что соединение *не
отключается *при таймауте. Таким образом, можно повторно отправить
затронутые сообщения позже, используя то *же *соединение, как только
брокер станет доступным.

***Операции***

Failover транспорт отслеживает транзакции по умолчанию. Транзакции в
полете воспроизводятся при повторном подключении. Для простых сценариев
это работает, как и ожидалось. Однако существует предположение
относительно подтвержденных (или потребительских) транзакций в том, что
ранее полученные сообщения будут автоматически воспроизводиться при
повторном подключении. Это, однако, не всегда верно, когда есть много
соединений и потребителей, так как заказ на повторную доставку не
гарантируется, поскольку устаревшие выдающиеся подтверждения могут
мешать новым доставленным сообщениям. Это может привести к
неподтвержденным сообщениям.

Заказ на повторную доставку \*\*\_is\_\*\* отслеживается, и транзакция
не будет зафиксирована, если ожидающие сообщения не доставлены после
восстановления после сбоя. javax.jms."TransactionRolledBackException'
создается в случае сбоя фиксации. Сомнительные транзакции приведут к
откату, так что они могут быть воспроизведены приложением. Сомнительные
транзакции происходят, когда происходит отработка отказа, когда
сообщение фиксации находится в полете. Невозможно узнать точную точку
отказа. Произошел ли сбой из-за того, что сообщение фиксации транзакции
не было доставлено или был потерян ответ фиксации? В любом случае,
становится необходимым откатить транзакцию, чтобы приложение могло
получить указание на сбой и справиться с любой потенциальной проблемой.

***Failover параметр на стороне менеджера очередей***

TransportConnector " имеет доступные опции, чтобы менеджер очередей мог
автоматически обновлять клиентов с информацией о наличии новых
менеджеров очередей, которые доступны (или больше не доступны) для
отработки отказа.

Параметры:

| **Параметр**                 | **Значение по умолчанию** | **Описание**                                                                                                                                                                                                       |
|------------------------------|---------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| updateClusterClients         | false                     | Если true, передайте подключенным клиентам информацию об изменениях топологии кластера менеджера очередей.                                                                                                         |
| rebalanceClusterClients      | false                     | Если true новый брокер присоединится к сети менеджеров очередей, подключенным клиентам будет предложено повторно сбалансировать кластер менеджеров очередей (Примечание: priorityBackup=true может переопределить) |
| updateClusterClientsOnRemove | false                     | Если true обновит клиенты при удалении кластера из сети. Наличие этой отдельной опции позволяет клиентам обновляться, когда новые менеджеры очередей присоединяются, но *не *когда менеджеры очередей уходят       |
| updateClusterFilter          | null                      | Разделенный запятыми список фильтров регулярных выражений, используемых для сопоставления имен менеджеров очередей, назначаемых как часть отказоустойчивого кластера для клиентов                                  |

Образец:

&lt;transportConnector name="openwire" uri="tcp://0.0.0.0:61616"
updateClusterClients="true"
updateClusterFilter=".\\\*A.\\\*,.\\\*B.\\\*"/&gt;

Когда updateClusterClients=true клиенты должны быть настроены только с
деталями одного менеджера очередей в кластере для подключения.

Образец:

failover:(tcp://primary:61616)

Когда новые менеджеры очередей присоединяются к кластеру, клиент
автоматически информируется об URI нового. Новый URI затем доступен для
отработки отказа, когда один из других известных менеджеров очередей
становится недоступным.

***Приоритетное Резервное Копирование***

Если менеджеры очередей доступны как в локальных, так и в удаленных
сетях, можно указать предпочтение для локальных брокеров по сравнению с
удаленными менеджерами очередей, используя опции priorityBackup и
priorityURI.Рассмотрим следующий URL:

failover:(tcp://local:61616,tcp://remote:61616)?randomize=false&priorityBackup=true

Учитывая этот URL, клиент будет пытаться подключиться и оставаться на
связи с локальным менеджером очередей. Если локальный брокер дает сбой,
он, конечно, переключится на удаленный. Однако при priorityBackup
использовании параметра клиент будет постоянно пытаться подключиться
к локальному . Как только клиент сможет это сделать, он снова
подключится к нему без необходимости ручного вмешательства.

По умолчанию только первый URI в списке считается приоритетным
(local). В большинстве случаев этого достаточно. Однако в некоторых
случаях может потребоваться несколько локальных URI. Этот priorityURIs
параметр можно использовать для указания того, какие URI считаются
приоритетными.

Образец:

failover:(tcp://local1:61616,tcp://local2:61616,tcp://remote:61616)?randomize=false&priorityBackup=true&priorityURIs=tcp://local1:61616,tcp://local2:61616

В этом случае клиент определит приоритет local1 или local2 брокеров и
(повторно)подключится к ним, если они доступны.

***Настройка вложенных параметров URI.***

Общие параметры URI можно настроить, добавив их в строку запроса URI
аварийного переключения, где каждый общий параметр URI имеет префикс:
nested.

Пример - вместо этого:

failover:(tcp://broker1:61616?wireFormat.maxInactivityDuration=1000,tcp://broker2:61616?wireFormat.maxInactivityDuration=1000,tcp://broker3:61616?wireFormat.maxInactivityDuration=1000)

сделать это:

failover:(tcp://broker1:61616,tcp://broker2:61616,tcp://broker3:61616)?nested.wireFormat.maxInactivityDuration=1000

Любой параметр, который может применяться к строке запроса отдельного
URI, является кандидатом для использования с nested параметром.

***Приоритет Опции***

Если один и тот же параметр указан как отдельный параметр URI и как
вложенный параметр, определение вложенного параметра будет иметь
приоритет.

***Параметры на стороне сервера***

Существует ряд параметров, которые можно использовать для изменения
поведения на сервере для TransportConnector конфигурации менеджера
очередей. Это:

| **Параметр**                 | **Значение по умолчанию** | **Описание**                                                                                                                                                                                                                                            |
|------------------------------|---------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| allowLinkStealing            | false                     | Это включено по умолчанию для транспорта MQTT. Кража ссылок -это когда последнее из двух или более соединений с одним и тем же идентификатором (clientID для JMS) считается действительным соединением, а более старое закрывается менеджером очередей. |
| discoveryURI                 | null                      |  Если задано, адрес обнаружения многоадресной рассылки для клиентских подключений для поиска менеджера очередей.                                                                                                                                        |
| enableStatusMonitor          | false                     | Будет отслеживать соединения, чтобы определить, если они заблокированы.                                                                                                                                                                                 |
| name                         | null                      | Имя экземпляра TransportConnector                                                                                                                                                                                                                       |
| rebalanceClusterClients      | false                     | Автоматически перераспределит клиентов по кластеру при изменении топологии.                                                                                                                                                                             |
| updateClusterClients         | false                     | Если этот параметр включен, будет обновляться клиентские подключения (если они используют failover://транспорт) изменений в кластере менеджера очередей.                                                                                                |
| updateClusterClientsOnRemove | false                     | Обновит клиентов, если брокер удален из кластера.                                                                                                                                                                                                       |
| updateClusterFilter          | null                      | Список регулярных выражений, разделенных запятыми. Для обновления клиентов будут включены менеджеры очередей с именем, соответствующим шаблону.                                                                                                         |
| uri                          | null                      | Адрес привязки для транспорта.                                                                                                                                                                                                                          |

Пример конфигурации:

     &lt;transportConnector name="openwire" uri="tcp://0.0.0.0:61616"
enableStatusMonitor="true"/&gt;

<a id="network_connectors"></a>

#### Каналы (сетевые коннекторы)

Сетевые коннекторы - это каналы, которые настроены между менеджерами
очередей таким образом, чтобы эти менеджеры очередей могли общаться друг
с другом. Сетевой коннектор однонаправленный канал по умолчанию. Данный
брокер взаимодействует в одном направлении, только пересылая полученные
сообщения менеджерам очередей на другой стороне соединения. Менеджеры
очередей могут быть соеденены каналами при помощи протоколов tcp, http и
других.

<a id="static_protocol"></a>

##### Static метод подключения

Static сетевой коннектор используется для создания статической
конфигурации нескольких менеджеров очередей в сети. Этот протокол
использует составной URI - URI, который содержит другие URI . Составной
URI состоит из нескольких адресов менеджера очередей или URI, которые
находятся на другом конце сетевого подключения.

Сообщения, отправленные локальному менеджеру очередей, будут
перенаправлены брокерам, работающим на remotehost1 и remotehost2 , но
только если есть спрос на эти сообщения от потребителя или активен
параметр «Отключить автоматическое определение потребителей очередей».

<a id="masterslave_protocol"></a>

#### Masterslave метод подключения

Данный метод подключения используется для создания канала между
менеджером очередей и группой менеджеров очередей (master/slave), где
один является главным (активным), а остальные подчиненными (пассивными),
при выходе из строя главного, его роль берет на себя один из
подчиненных.